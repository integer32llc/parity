# Integer 32 SOW (proposed) - 65 hours

- Fork from stable Parity 1.6.8
  - License will be GPLv3, matching Parity

- (37 hours total) Implementation
  - (4 hrs) Set up a working set of nodes using Parity‚Äôs Authority Round to ensure Parity is functioning as expected
  - (12 hrs) Add an [Engine spec](https://github.com/integer32llc/parity/blob/c39622952d7e1bc89fba1d0559125f66b2f004a0/json/src/spec/engine.rs#L23) and define deserialization of parameters from JSON (ex: [AuthorityRound spec)](https://github.com/integer32llc/parity/blob/c39622952d7e1bc89fba1d0559125f66b2f004a0/json/src/spec/authority_round.rs)
    - Including values configurable via the [chain config file](https://github.com/paritytech/parity/wiki/Configuring-Parity#config-file)
      - Slot duration in seconds
      - Security parameter *k*: 60
      - [Network Diameter](https://cardanodocs.com/cardano/differences/#block-generation-time)
      - Hardcoded, immutable list of leaders ([‚Äúvalidators‚Äù](https://github.com/paritytech/parity/wiki/Validator-Set#immutable-list)) and their stakes
      - Hardcoded genesis block contents: Translate the precomputation of the list of slot leaders for epoch 0 that cardano does and stores in core/genesis-core.bin into the Parity engine configuration
      - Hardcoded genesis block seal
  - (1 hr) Add a [Seal spec](https://github.com/integer32llc/parity/blob/c39622952d7e1bc89fba1d0559125f66b2f004a0/json/src/spec/seal.rs#L55) and define deserialization of parameters from JSON (ex: [AuthorityRoundSeal spec](https://github.com/integer32llc/parity/blob/c39622952d7e1bc89fba1d0559125f66b2f004a0/json/src/spec/seal.rs#L35))
  - (20 hrs total) Implement the Engine trait with the Ouroboros Static State/Stake (ùõëSPoS) algorithm for use in Parity
    - (10 hrs) Implement a `step` function similar to what Authority Round has in order to know which slot we are currently in
      - Query [NTP servers](https://github.com/input-output-hk/cardano-sl/blob/f754d7a48294d7c434d401af12075dbe3fa4a7a9/infra/Pos/Slotting/Ntp.hs#L333) and calculate the [‚Äúreal time‚Äù](https://cardanodocs.com/technical/time/)
        - Poll NTP servers [every 15 seconds](https://github.com/input-output-hk/cardano-sl/blob/f754d7a48294d7c434d401af12075dbe3fa4a7a9/core/constants-prod.yaml#L49)
        - Assuming the [ntp crate](https://crates.io/crates/ntp) is appropriate
      - Implement the timeout such that the leader announces the block `networkDiameter` seconds before the end of the slot
    - (8 hrs) Implement `[generate_seal](https://github.com/integer32llc/parity/blob/c39622952d7e1bc89fba1d0559125f66b2f004a0/ethcore/src/engines/mod.rs#L141)` to seal the block if the current node is the slot leader
    - (1 hr) Implement `[register_client](https://github.com/integer32llc/parity/blob/c39622952d7e1bc89fba1d0559125f66b2f004a0/ethcore/src/engines/mod.rs#L225)`, `[set_signer](https://github.com/integer32llc/parity/blob/c39622952d7e1bc89fba1d0559125f66b2f004a0/ethcore/src/engines/mod.rs#L219)` like `[AuthorityRound](https://github.com/integer32llc/parity/blob/c39622952d7e1bc89fba1d0559125f66b2f004a0/ethcore/src/engines/authority_round.rs#L379)` does
    - (1 hr) Implement the remaining Engine trait required methods name, params, builtins

- (28 hrs total) Evaluation
  - (8 hrs) Verify correctness of the implementation
    - Write unit tests similar to `[AuthorityRound](https://github.com/paritytech/parity/blob/master/ethcore/src/engines/authority_round.rs#L473)`['s](https://github.com/paritytech/parity/blob/master/ethcore/src/engines/authority_round.rs#L473)
    - Evenly distributed stake should result in evenly distributed signing of blocks
    - Compare chains generated by cardano and by parity for the same node setup and the same set of transactions; not for exact equality but for which transactions were included in the chain or some other measure of approximate equivalence
  - (16 hours) Best effort to replicate results of Parity‚Äôs Authority Round chain from the Snow White paper, using Parity 1.6.8 and its Authority Round chain implementation
    - Snow White performance of a single node which engages in no network communication was measured at approximately 125 tx/s
    - high-bandwidth and low latency environment, but multi-AWS region - distribution TBD
    - 15 min run where all 40 nodes were submitting the **maximum amount of possible transactions** (what is this number?) through the Parity RPC interface, implemented as a bash script of curl requests
    - Resulting moving average of number of transactions processed per second over 60 seconds ranging between 100 and 150 transactions per second
  - (4 hours) Run Ouroboros Parity plugin under similar conditions and collate results

# Out of scope for this SOW (proposed)

- Customizing the signing method, node addressing, [block verification](https://github.com/integer32llc/parity/blob/c39622952d7e1bc89fba1d0559125f66b2f004a0/ethcore/src/engines/mod.rs#L183), finding longest chain, etc from what Parity provides by default
- Anonymous communication
- Incentive transactions
- Delegation of stake
- Replicating Ouroboros experiments with network distributed among EC2 instances around the world
- Creating the equivalent of cardano-smart-generator to create parity transactions in the network
- Elect leaders for the next epoch. Not tested by Snow White since Parity Authority doesn‚Äôt support it, not needed for this initial round
- Produce Rust equivalent of pvss-haskell for PVSS
  - Reusing quickcheck tests from pvss-haskell, or unit tests derived from them
- Doing anything with ethereum/parity gas limit
- `ScriptAddress` https://cardanodocs.com/cardano/addresses/
- Update mechanisms https://cardanodocs.com/cardano/update-mechanism/
